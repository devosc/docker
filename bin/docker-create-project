#!/usr/bin/env bash

# creates project in docker www directory (experimental).

project_dir="$( cd "$(dirname "$0")/../www" ; pwd -P )"

[ -d $project_dir/html ] && document_root="$project_dir/html" || document_root="$project_dir/public"

cd $project_dir

find . -type f -delete
find . -type l -delete
find . -type d -name '*' -delete

cd $project_dir/..

if [ "wordpress" = "$1" ]; then
    wget https://wordpress.org/latest.tar.gz
    tar -xzvf latest.tar.gz --directory $project_dir
    rm -rf $document_root
    mv $project_dir/wordpress $document_root
    rm latest.tar.gz

    proxy="\\
\\
// https://codex.wordpress.org/Administration_Over_SSL \\
define('FORCE_SSL_ADMIN', true); \\
\\
if (strpos(\$_SERVER['HTTP_X_FORWARDED_PROTO'], 'https') !== false)\\
    \$_SERVER['HTTPS']='on';"

    sed -i.bak "s#define('WP_DEBUG', false);#define('WP_DEBUG', false);$proxy#g" "$document_root/wp-config-sample.php"
    rm "$document_root/wp-config-sample.php.bak"

elif [ "laravel" = "$1" ]; then
    docker-composer create-project --prefer-dist laravel/laravel .
elif [ "symfony" = "$1" ]; then
    docker-composer create-project --prefer-dist symfony/website-skeleton .
elif [ "phpinfo" = "$1" ]; then
    mkdir -p $document_root
    cat <<EOT >> $document_root/index.php
<?php

phpinfo();
EOT
else
    docker-composer create-project mvc5/mvc5-application .
fi
