#!/usr/bin/env bash

source docker-build-env

file="$(pwd)/docker-compose.yml"

if [ -f $file ]; then
    # remove images
    rmi=""
    if [ "--remove-images" = "$1" ] || [ "--remove-images" = "$2" ]; then
        images=$(docker-compose --file $file images -q)
        if [ "$images" != "" ]; then
            rmi="--rmi local"
        else
            echo -e "\x1B[1;31mNo project images\x1B[0m"
        fi
    fi

    # stop project
    docker-compose --file $file down --remove-orphans $rmi;

else
    echo -e "\x1B[1;31mProject not found\x1B[0m"
fi

# stop all containers

if [ "-a" = "$1" ] || [ "-a" = "$2" ]; then
    containers=$(docker ps -aq)
    if [ "$containers" != "" ]; then
        echo -e "\x1B[1;32mRemoving containers\x1B[0m"
        docker stop $containers
        docker rm $containers
    else
        echo -e "\x1B[1;31mNo containers\x1B[0m"
    fi
fi
