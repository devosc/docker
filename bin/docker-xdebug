#!/usr/bin/env bash

source docker-build-env

directory="$(pwd)"
enable=false

if [ -z "$1" ] || [ "$1" = "on" ]; then
    enable=true
elif [ "$1" != "off" ]; then
    echo "Usage: docker-xdebug on|off [--project-directory path]"
    exit 1
fi

if [ "$2" = "--project-directory" ]; then
    if [ -z "$3" ]; then
        echo "Error: project directory cannot be empty."
        exit 1
    fi

    directory="$3"
fi

if $enable ; then
    docker-root --project-directory "$directory" sed -i 's/;zend_extension=/zend_extension=/g' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
    docker-root --project-directory "$directory" apache2ctl -k graceful
    echo "Xdebug has been turned on."
else
    docker-root --project-directory "$directory" sed -i 's/zend_extension=/;zend_extension=/g' /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
    docker-root --project-directory "$directory" apache2ctl -k graceful
    echo "Xdebug has been turned off."
fi
